---
output:
  md_document:
    variant: markdown_github
---

# Purpose

Purpose of this work folder.

Ideally store a minimum working example data set in data folder.

Add binary files in bin, and closed R functions in code. Human Readable settings files (e.g. csv) should be placed in settings/


```{r}

rm(list = ls()) # Clean your environment:
gc() # garbage collection - It can be useful to call gc after a large object has been removed, as this may prompt R to return memory to the operating system.
library(tidyverse)
library(lubridate)
library(RColorBrewer)
library(kableExtra)
list.files('code/', full.names = T, recursive = T) %>% .[grepl('.R', .)] %>% as.list() %>% walk(~source(.))
#this line of code is used to execute any functions I've made that are in the code folder
```


```{r loading data}
Lst_matches <- 
    list.files("data/Tennis/", full.names = T) %>% 
    .[grepl("atp_matches", .)] %>% 
    .[!grepl("doubles|qual|amateur", .)] %>% as.list()

playerinfo <-
        read_csv("data/Tennis/atp_players.csv") %>% select(player_id, hand, height)

# I want to only look at Grandslams, Masters and Finals - use Tournament_Inputs to filter.
suppressWarnings(result_Large_events <- Data_Prep_Function(Lst, Tournament_Inputs = c("G", "M", "F")))

Lst_rankings <- list.files("data/Tennis/", full.names = T) %>% 
    .[grepl("atp_rankings", .)] %>% as.list()
rankings <- Ranking_Prep_Function(Lst_rankings) %>% group_by(year = lubridate::year(date)) %>% filter(date == max(date))
```
This data shows all the stats since the start of the Open Era of tennis (1968, when it became professional) for the main tournaments (Grand Slams, Masters and Tour Finals) as well as the year end top 20 rankings from the 1970s to 2021.

Descriptive stats
I want to look at some stats through time - so maybe grouped into decades who won the most Grand Slams or finished world number 1 etc. But then i can show how since the 2000s, the game has been dominated by the Big 3 and so I can focus on them. It would also be nice to include something about the new guys - Alcaraz, Ruud, Zverev, Tsitsipas etc. This can all be part of my introductory statistics and then the model will be for the Big 3. 

The grouping into decades thing didn't work as well as I would have liked so let me rather just explain things over time through research as then focus on doing stats for the current guys.

```{r}
finals <- result_Large_events %>% filter(round == "F")

frequent_winners <- finals %>% filter(tourney_level == "G") %>% 
  mutate(decade = floor_date(date, "10 years")) %>%
  group_by(decade, winner_name) %>%
  summarize(winner_count = n()) %>%
  top_n(1, winner_count) %>%
  arrange(decade, desc(winner_count)) 






#ggplot(frequent_winners, aes(fill=winner_name, y=winner_count, x=winner_name)) + 
    #geom_bar(position="dodge", stat="identity") +
    #ggtitle("Top Grand Slam Winners per Decade") +
    #theme_bw() +
    #facet_wrap(~decade) +
    #theme(legend.position="none") +
    #xlab("")
```
```{r}
#table <- current_winners(finals)
#table
```
```{r}
table2 <- current_winners_GS(finals)
table2
```
```{r}
df <- finals %>% filter(year(date) >= 2000) %>% filter(tourney_level == "G") %>%
        select(c("date", "tourney_name", "winner_name"))

df$year <- year(as.Date(df$date))

pivot_table <- df %>% group_by (year) %>% pivot_wider(
        names_from = tourney_name,
        values_from = winner_name
    )

pivot_table$date <- NULL

pivot_table <- pivot_table[, -ncol(pivot_table)]
pivot_table$year <- as.character(pivot_table$year)
filterW <- pivot_table %>% filter(!is.na(Wimbledon)) %>% select(c(Wimbledon))

filterR <- pivot_table %>% filter(!is.na(`Roland Garros`)) %>% select(c(`Roland Garros`))

filterUS <- pivot_table %>% filter(!is.na(`US Open`)) %>% select(c(`US Open`))

filterA <- pivot_table %>% filter(!is.na(`Australian Open`)) %>% select(c(`Australian Open`))

merged_df <- merge(merge(merge(filterA, filterR, by = "year"), filterW, by = "year"), filterUS, by = "year")

merged_df

# Fill the NAs with empty strings
pivot_table <- pivot_table %>% fill(everything(), .direction = "down")

# Remove duplicate rows
pivot_table <- distinct(pivot_table, .keep_all = TRUE)
```






